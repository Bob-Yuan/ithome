function RuanmeiJsFunctions(){function navTo(e,t){if(isWxmp())wx.miniProgram[e]({url:"/pages/webview/webview?url="+encodeURIComponent(t.url)});else if(that.isLegalEnv())callNative(e,{url:getTargetUrl(t),openExternal:!!t.openExternal,intent:t.intent},null);else{var n=document.createElement("a");n.href=t.url,"navigateTo"==e&&(n.target="_blank"),n.click()}}function addRNCallback(e,t){var n=++rnLastCallbackId;return rnCallbacks[""+n]={callback:e,context:t},n}function registerJsFuns(e,t){errorMsg+="-- register Js Funs.\n",e[t]("onPageVisibleChanged",function(e){_onPageVisibleChanged&&_onPageVisibleChanged(genObj(e))}),e[t]("onAppThemeChanged",function(e){resetTheme(genObj(e))}),e[t]("onOptionMenuClicked",function(e){_optionMenuCB&&_optionMenuCB(genObj(e))}),e[t]("onReceiveMessage",function(e,t){var n=genObj(e),i=n.name;if(void 0!==_listeners[i]){var s=null;t&&(s=function(e){t("object"==typeof e?JSON.stringify(e):e)}),_listeners[i](n.data,s)}})}function doneBridge(e){function t(){isWxmp()?(document.write("<script src='https://dat.ruanmei.com/lib/showToast.js'><\/script>"),window._parseJSSDKKey=function(e){secret=window.atob(e);var t=parseUrl(this.window.location.href).params._rmsdktoken;if(!isEmpty(t)){var n=JSON.parse(that.decryptSync({text:t}).data),o=n.__hash;wxAppName=n.__appName||"unknown",delete n.__hash,hash={success:!0,userHash:o},userInfo={success:!0,userInfo:n}}s=!0,a=!0,r=!0,i()},document.write("<script src='https://dat.ruanmei.com/lib/rm-js-sdk-key.js'><\/script>")):(s=!0,a=!0,r=!0,i())}function n(e){console.warn("JS-SDK",e)}function i(){if(!isReady&&s&&a&&r){isReady=!0;try{var e="*{-webkit-tap-highlight-color: rgba(0, 0, 0, 0) !important;}.disable-user-select-ruanmei-sdk * {-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;}pre,input,textarea{-webkit-touch-callout:default;-webkit-user-select:text;user-select:text;}",t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)}catch(e){}readyCallbacks.forEach(function(e){e()})}}if(null==e)return errorMsg+="-- init bridge error(null).\n",void t();bridgeInternal=e,callNative=function(e,t,n){if(that.isLegalEnv()){if(isWxmp()){if("getUserHash"===e&&hash.success)return n(hash);if("encrypt"===e)return n(that.encryptSync(t));if("decrypt"===e)return n(that.decryptSync(t));if("toast"===e)return window._showToast&&window._showToast(t.data,t.duration||5e3);n&&n({success:!1,message:"微信小程序不支持此操作，请使用IT之家App"})}else if(isUWP||isReactNative&&-1!==rnApis.indexOf(allApiNames.indexOf(e))||isCommonChannel){null!=t&&void 0!==t||(t={});var i=t;isCommonChannel?i={name:e,data:t,isInternalApi:!0}:isUWP||"object"!=typeof t||Array.isArray(t)?i={name:"sdk-api-"+e,data:t}:i.name="sdk-api-"+e,that.sendMessage(i,n)}else if(isAndroid||isIOS||isMac&&!isElectron){var s=isAndroid?"call":"callHandler";null!==n?bridgeInternal[s](e,t,function(e){n(genObj(e))}):bridgeInternal[s](e,t)}}else n&&n({success:!1,message:"运行环境非法(005)"})};var s=!1,a=!1,r=!1;if(that.isLegalEnv()&&!isWxmp()){if(!useNewInit){try{callNative("getUserInfo",null,function(e){userInfo=e,a=!0,i()})}catch(e){a=!0,i(),n("User check failed!")}try{callNative("getUserHash",null,function(e){hash=e,r=!0,i()})}catch(e){r=!0,i(),n("Userhash check failed!")}}try{callNative("getSystemInfo",{needAuth:!0},function(e){void 0!==e.systemInfo&&(e.systemInfo.isWxmp=!1),sysInfo={success:e.success,systemInfo:e.systemInfo},intent=e.intent?e.intent:null,isEmpty(e.extra)||(secret=e.extra),s=!0,e._userInfo&&(userInfo=e._userInfo,a=!0),e._userHash&&(hash=e._userHash,r=!0),i()})}catch(e){s=!0,i(),n("System check failed!")}}else t()}function setupWebViewJavascriptBridge(e){if(window.WebViewJavascriptBridge)return e(WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var t=document.createElement("iframe");t.style.display="none",t.src="https://__bridge_loaded__",document.documentElement.appendChild(t),setTimeout(function(){document.documentElement.removeChild(t)},0)}function processRnOrElCallback(e){console.log("receive-native-message",e);var t=e,n=t.callbackId;if(delete t.callbackId,-1==n)_onPageVisibleChanged&&_onPageVisibleChanged(genObj(t));else if(-2==n)resetTheme(t);else if(n>-1){var i=rnCallbacks[""+n];i.callback.call(i.context,t),delete rnCallbacks[""+n]}}function resetTheme(e){e.isDark=e.isNight||e.isDark,null!==_onAppThemeChanged?_onAppThemeChanged(e):(toggleCLass("html",e.isDark,"night"),toggleCLass("body",e.isDark,"night"))}function toggleCLass(e,t,n){try{document.getElementsByTagName(e)[0].classList[t?"add":"remove"](n)}catch(e){}}function getTargetUrl(e){var t={};Object.keys(e).forEach(function(n){t[n.toLowerCase().replace(/-/g,"")]=e[n]});var n=t.url,i=relation[appStr].s+getPlat().toLowerCase().replace("/",""),s=relation[appStr].f;return isEmpty(t[i])?isEmpty(t[s])||(n=t[s]):n=t[i],getAbsolutePath(n)}function isEmpty(e){return null==e||void 0===e||0==e.length}function isWxmp(){return"miniprogram"===window.__wxjs_environment||-1!==window.navigator.userAgent.indexOf("miniProgram")}function convert2QueryString(e){var t="";if("string"==typeof e)for(var t=e;t.length>1&&(0==t.indexOf("&")||0==t.indexOf("?"));)t=t.substring(1);else if("object"==typeof e){var n=e;for(var i in n){var s=n[i],a=encodeURIComponent(i)+"="+encodeURIComponent(s);t+=(0===t.length?"":"&")+a}}return t}function getAbsolutePath(e){var t=document.createElement("a");return t.href=e,t.href}function parseUrl(e){var t=e.split("://"),n=t[0],i=t[1];-1!=i.indexOf("/")&&(i=i.split("/")[0]),-1!==i.indexOf("?")&&(i=i.substring(0,i.indexOf("?"))),-1!==i.indexOf("#")&&(i=i.substring(0,i.indexOf("#")));var s={},a="",r="",o=e.substring(e.indexOf("?")+1,e.length).split("&");for(var l in o){var c=o[l];c.indexOf("=")>0&&(a=c.substring(0,c.indexOf("=")),r=c.substring(c.indexOf("=")+1),-1!==r.indexOf("#")&&(r=r.substring(0,r.indexOf("#"))),s[a]=decodeURIComponent(r))}return{scheme:n.toLowerCase(),host:i.toLowerCase(),params:s}}function _ajax(e,t){e=e||{},e.method=(e.method||"POST").toUpperCase(),e.url=e.url||"",e.async=e.async||!0,e.data=e.data||null,e.callback=t||function(){};var n=null;n=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.open(e.method,e.url,e.async);for(var i in e.header){var s=e.header[i];n.setRequestHeader(i,s)}n.send("POST"===e.method.toUpperCase()?e.data:null),n.onreadystatechange=function(){if(4==n.readyState){var t=n.status;e.callback({statusCode:t,data:t>=200&&t<300?genObj(n.responseText):null})}}}function genObj(e){var t=e;try{t="object"==typeof e?e:JSON.parse(e)}catch(n){t=e}return t}function is(e){return relation[appStr].s===e||relation[appStr].f===e}function getPlat(){var e="unknown";return isAndroid?e="Android":isIOS?e="iOS":isUWP?e="UWP":isElectron?(e="Electron",-1!==UA.indexOf("macOS")?e+="/macOS":-1!==UA.indexOf("win32")?e+="/win32":-1!==UA.indexOf("linux")&&(e+="/linux")):isMac?e="macOS":isWin&&(e="windows"),e}function getArgs(e){for(var t=null,n=null,i=0;i<e.length;i++)"function"==typeof e[i]?t=e[i]:void 0!==e[i]&&(n=e[i]);return[n,t]}var that=this,UA=navigator.userAgent,isAndroid=/(Android)/i.test(UA),isIOS=/(iPhone|iPad|iPod|iOS)/i.test(UA),isUWP=/(uwpclient)/i.test(UA),isMac=/(Macintosh)/i.test(UA),isWin=/(Windows NT)/i.test(UA),isNative=/(\/native\/)/i.test(UA),useNewInit=/(\/rmsdklevel2\/)/i.test(UA),tRes=(UA+" ").match(/ (ithome|lapin|ggUnionClient|taofuli|mytime|zuihuimai)\S*\/(\d+\.\d+)\s+/)||["/-1","unknown","-1"],pIdx=tRes[2].indexOf("."),appStr=tRes[1],appver=parseFloat(-1===pIdx?tRes[2]:tRes[2].substring(0,pIdx+1)+tRes[2].substring(pIdx+1).replace(/\./g,"")),relation={ithome:{s:"it",f:"ithome",m:6.38,t:"n"},lapin:{s:"lp",f:"lapin",m:3.63,t:"n"},ggUnionClient:{s:"ad",f:"adunion",m:1,t:"n"},taofuli:{s:"tao",f:"taofuli",m:1,t:"r"},mytime:{s:"mt",f:"mytime",m:.58,t:"n|r|e"},zuihuimai:{s:"zhm",f:"zuihuimai",m:1,t:"n"},unknown:{s:"unknown",f:"unknown",m:999,t:"n"}},isWkwebview=-1!==UA.indexOf("wkwebview"),isReactNative=(isAndroid||isIOS)&&(/(\/reactnative\/)/i.test(tRes[0])||-1!==relation[appStr].t.indexOf("r")&&!/(\/native\/)/i.test(tRes[0])&&!/(\/flutter\/)/i.test(tRes[0])),isElectron=-1!==UA.indexOf("Electron"),isCommonChannel=isElectron||isWin&&isNative,wxAppName="unknown",sdkver=2.51,allApiNames=["canIUse","closeWindow","getSettings","getUserInfo","getUserHash","getSystemInfo","setClipboardData","getClipboardData","navigateTo","redirectTo","toast","login","hideMenus","scanCode","showMenus","share","shareConfig","showModal","encrypt","decrypt","downloadFile","saveImageToPhotosAlbum","onEvent","previewImage","hideToast","showLoading","hideLoading","getPushTags","request","addOrRemovePushTags","showActionSheet","requestPayment","onPageVisibleChanged","showUpgradeTip","openKeyboard"],wxCanUse=[0,15,13,1,8,9,23,19,18,11,3,4,5,28,10],normalApis=[2,4,6,7,10,12,14,16,17,18,19,20,21,22,24,25,26,27,29,30,31,33],rnApis=[3,4,12,14,16,11,1,8,9,2,13,15,10,16,23,25,26,32,30],isReady=!1,readyCallbacks=[],userInfo={},hash="",sysInfo={},intent=null,bridgeInternal=null,errorMsg="SDK initialization not finished, please wait.\n ",callNative=function(e,t,n){if(null!=n){var i=errorMsg;isAndroid&&!window._dsbridge||isIOS&&!window.WebViewJavascriptBridge?i+="-- Bridge status: not exist.\n ":(isAndroid&&window._dsbridge||isIOS&&window.WebViewJavascriptBridge)&&(i+="-- Bridge status: has injected. \n"),n({success:!1,message:i})}},_onPageVisibleChanged=null,_onAppThemeChanged=null,_optionMenuCB=null,_listeners={},secret="",encryptStr=function(m,k){return eval(secret),{success:!0,data:enc(m,k).toString()}},decryptStr=function(m,k){return eval(secret),{success:!0,data:dec(m,k).toString()}},textSelectable=!1,rnCallbacks={},rnLastCallbackId=0;if(this.ready=function(e){isReady?e():readyCallbacks.push(e)},normalApis.forEach(function(e){var t=allApiNames[e];that[t]=function(){var e=getArgs(arguments);callNative(t,e[0],e[1])}}),this.openKeyboard=function(e){callNative("openKeyboard",null,null),e&&setTimeout(function(){var t=document.getElementById(e);t&&t.focus()},300)},this.bindNavigation=function(cb){that.isLegalEnv()&&(window.__rmNavLitener||(window.__rmNavLitener=function(e){if(e.target.hasAttribute("rm-nav")){var redirect=e.target.hasAttribute("redirect"),sName="href-"+relation[appStr].s+"-"+getPlat().toLowerCase().replace("/","-"),fName="href-"+relation[appStr].f,url=e.target.getAttribute(sName)||e.target.getAttribute(fName)||e.target.getAttribute("href");isEmpty(url)||(0==url.indexOf("javascript:")?eval(url.substring(11)):that[redirect?"redirectTo":"navigateTo"]({url:url})),e.preventDefault()}}),document.removeEventListener("click",window.__rmNavLitener,!1),document.addEventListener("click",window.__rmNavLitener,!1)),cb&&cb({success:that.isLegalEnv()})},this.sendMessage=function(e){var t="function"==typeof arguments[1]?arguments[1]:null;if(isReactNative&&"native"!==e.proxyEnv||isUWP||isCommonChannel){isCommonChannel&&!e.isInternalApi&&(e={name:"sendMessage",data:e}),e.callbackId=null!=t?addRNCallback(t,this):-1;var n=isCommonChannel?e:JSON.stringify({name:"SDK-sendMessage",message:JSON.stringify(e)}),i=isReactNative?"ReactNativeWebView":"UWPOrElBridge";console.log("js-call-native",n),window[i].postMessage(n)}else callNative("sendMessage",e,t)},this.onReceiveMessage=function(e,t){_listeners[e]=t},this.config=function(e){var t=e.pageAttr;void 0!==t&&(textSelectable=!!t.textSelectable,that.setTextSelectEnable(textSelectable)),callNative("config",e,null)},this.isLegalEnv=function(){return is("it")&&isMac&&appver>=1.35||appver>=relation[appStr].m||isWxmp()},this.setTextSelectEnable=function(e){textSelectable=e,toggleCLass("body",!e,"disable-user-select-ruanmei-sdk")},this.getEnv=function(){var e=relation[appStr].f;isWxmp()&&(e="wxmp");var t="unknown";return that.isLegalEnv()&&(t="native"),isReactNative&&(t="react native"),isElectron&&(t="electron"),{isLegal:that.isLegalEnv(),app:isWxmp()?wxAppName:e,platform:getPlat(),appver:isWxmp()?6.6:appver,sdkver:sdkver,isWxmp:isWxmp(),framework:t}},this.getSystemInfo=function(e){if(isWxmp()){var t={};t.isWxmp=isWxmp(),t.platform=getPlat(),e({success:!0,systemInfo:t})}else callNative("getSystemInfo",null,function(t){void 0!==t.systemInfo&&(t.systemInfo.isWxmp=!1),e(t)})},this.getSystemInfoSync=function(){if(isWxmp()){var e={};return e.isWxmp=isWxmp(),e.platform=getPlat(),{success:!0,systemInfo:e}}return sysInfo},this.getIntent=function(){return intent},this.createOptionMenus=function(e,t){_optionMenuCB=t,callNative("createOptionMenus",e,null)},this.login=function(){var e=getArgs(arguments);if(isWxmp()&&userInfo.success)return e[1](userInfo);callNative("login",e[0],function(t){userInfo=t,callNative("getUserHash",null,function(n){hash=n,e[1](t)})})},this.getUserInfo=function(){var e=getArgs(arguments);if(isWxmp()&&userInfo.success)return e[1](userInfo);callNative("getUserInfo",e[0],function(t){userInfo=t,e[1](t)})},this.getUserInfoSync=function(){return userInfo},this.getUserHashSync=function(){return hash},this.share=function(e,t){isWxmp()?wx.miniProgram.navigateTo({url:"/pages/tool/share?"+convert2QueryString({title:e.title,image:e.imgUrl,url:e.url})}):callNative("share",e,t)},this.scanCode=function(e,t){isWxmp()?wx.scanQRCode({needResult:!!e.needResult,success:function(e){t({success:!0,data:e.resultStr})}}):callNative("scanCode",e,t)},this.canIUse=function(e,t){if(isWxmp()){var n=[];e.forEach(function(e){-1==wxCanUse.indexOf(allApiNames.indexOf(e))&&n.push(e)}),t({success:0==n.length,cannot:n})}else that.isLegalEnv()?callNative("canIUse",e,function(e){var n=e;isReactNative&&(n.cannot=n.cannot||[],n.cannot=n.cannot.filter(function(e){return-1==rnApis.indexOf(allApiNames.indexOf(e))}),n.success=0==n.cannot.length),t(n)}):t({success:!1,cannot:e})},this.closeWindow=function(){isWxmp()?wx.miniProgram.navigateBack({delta:1}):callNative("closeWindow",null,null)},this.onPageVisibleChanged=function(e){_onPageVisibleChanged=e},this.onAppThemeChanged=function(e){_onAppThemeChanged=e},this.request=function(e,t){var n={},i="GET",s=getAbsolutePath(e.url);void 0!==e.method&&"post"==e.method.toLowerCase()&&(i="POST");var a=e.header,r="content-type",o="application/x-www-form-urlencoded";void 0===a&&(a={}),void 0===a[r]&&(a[r]=o);var l=null;if("GET"==i){var c=convert2QueryString(e.data);c.length>0&&(s+=(-1!==s.indexOf("?")?"&":"?")+c)}else l=e.data,"application/json"===a[r]?l=JSON.stringify(e.data):a[r]===o&&(l=convert2QueryString(e.data));n.method=i,n.url=s,n.header=a,n.data=l;var d=parseUrl(s),u=parseUrl(window.location.href);d.scheme==u.scheme&&d.host==u.host?_ajax(n,t):callNative("request",n,t)},this.navigateTo=function(e){navTo("navigateTo",e)},this.redirectTo=function(e){navTo("redirectTo",e)},this.previewImage=function(e){isWxmp()?wx.previewImage({current:e.url,urls:e.imgUrls}):callNative("previewImage",e,null)},this.encryptSync=function(e,t){return encryptStr(e.text,e.key)},this.decryptSync=function(e,t){return decryptStr(e.text,e.key)},isReactNative||isUWP?document.addEventListener("rnJsSdkCallback",function(e){processRnOrElCallback(e.data)},!1):isCommonChannel&&(window.__electronOnMessage=processRnOrElCallback),!that.isLegalEnv()||isWxmp())doneBridge({});else if(isAndroid){var bridge={default:this,call:function(e,t,n){var i="";"function"==typeof t&&(n=t,t={});var s={data:void 0===t?null:t};if("function"==typeof n){var a="dscb"+window.dscb++;window[a]=n,s._dscbstub=a}return s=JSON.stringify(s),window._dsbridge?i=_dsbridge.call(e,s):(window._dswk||-1!==navigator.userAgent.indexOf("_dsbridge"))&&(i=prompt("_dsbridge="+e,s)),JSON.parse(i||"{}").data},register:function(e,t,n){var i=n?window._dsaf:window._dsf;window._dsInit||(window._dsInit=!0,setTimeout(function(){bridge.call("_dsb.dsinit")},0)),"object"==typeof t?i._obs[e]=t:i[e]=t},registerAsyn:function(e,t){this.register(e,t,!0)},hasNativeMethod:function(e,t){return this.call("_dsb.hasNativeMethod",{name:e,type:t||"all"})},disableJavascriptDialogBlock:function(e){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==e})}};!function(){if(!window._dsf){var e={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,dsBridge:bridge,close:function(){bridge.call("_dsb.closePage")},_handleMessageFromNative:function(e){var t=JSON.parse(e.data),n={id:e.callbackId,complete:!0},i=this._dsf[e.method],s=this._dsaf[e.method],a=function(e,i){n.data=e.apply(i,t),bridge.call("_dsb.returnValue",n)},r=function(e,i){t.push(function(e,t){n.data=e,n.complete=!1!==t,bridge.call("_dsb.returnValue",n)}),e.apply(i,t)};if(i)a(i,this._dsf);else if(s)r(s,this._dsaf);else{var o=e.method.split(".");if(o.length<2)return;var l=o.pop(),c=o.join("."),d=this._dsf._obs,u=d[c]||{},f=u[l];if(f&&"function"==typeof f)return void a(f,u);if(d=this._dsaf._obs,u=d[c]||{},(f=u[l])&&"function"==typeof f)return void r(f,u)}}};for(var t in e)window[t]=e[t];bridge.register("_hasJavascriptMethod",function(e,t){var n=e.split(".");if(n.length<2)return!(!_dsf[n]&&!_dsaf[n]);var e=n.pop(),i=n.join("."),s=_dsf._obs[i]||_dsaf._obs[i];return s&&!!s[e]}),registerJsFuns(bridge,"registerAsyn")}}(),doneBridge(bridge)}else isIOS||isMac&&!isElectron?(errorMsg="SDK initialization Begin.\n",isReactNative&&!window.ReactNativeWebView&&(isWkwebview?window.ReactNativeWebView={postMessage:function(e){window.webkit.messageHandlers.ReactNativeWebView.postMessage(String(e))}}:function(){function e(){t.length&&!n&&(n=!0,document.location="react-js-navigation://ReactNativeWebView?"+encodeURIComponent(t.shift()))}var t=[],n=!1;window.ReactNativeWebView={postMessage:function(n){t.push(String(n)),e()},messageReceived:function(){n=!1,e()}}}()),setupWebViewJavascriptBridge(function(e){errorMsg+="-- js injected.\n",registerJsFuns(e,"registerHandler"),doneBridge(e)})):(isUWP||isCommonChannel)&&(window.UWPOrElBridge={postMessage:function(e){if(isUWP)window.external.notify(e);else{var t=window.__electronPostMessage;t&&t("sdkMsg",e)}}},doneBridge({}))}const rm=new RuanmeiJsFunctions;